aa <- data.frame()
is.null(aa)
aa[1][1]
is.na(aa)
is.nan(aa)
is.nan(aa)
is.object(aa)
if (aa) {print("yes")}
if (aa){
print('yes')
}
length(aa)
if (length(snp_table)!=0) {
chromosome <- snp_table$chr
query1 <- sprintf('select distinct Gene.ENSG,Gene.symbol,ENST,ENSE,
Gene.start_at as G_start,Gene.end_at as G_end,Exon.start_at as E_start,
Exon.end_at as E_end,strand
from Exon join Gene using(ENSG)
where Gene.chromosome = (select distinct chr from Exon_SNP where snp="%s")
and Gene.end_at>(select distinct position-25000 from Exon_SNP where snp="%s")
and Gene.start_at<(select distinct position+25000 from Exon_SNP where snp="%s")
order by Gene.ENSG, Gene.start_at, Exon.start_at;',variant,variant,variant)
res1<-dbSendQuery(con,query1)
gene_table <- dbFetch(res1)
minp <- min(gene_table$G_start)
maxp <- max(gene_table$G_end)
query2 <- sprintf('select chr,pos,recomb_rate from Recomb_rate
where chr = "%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res2 <- dbSendQuery(con,query2)
Recomb_rate <- dbFetch(res2)
query3 = sprintf('select chr,pos,trait,snp from GWAS_catalog
where chr ="%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res3 <- dbSendQuery(con,query3)
GWAS_cat <- dbFetch(res3)
dbDisconnect(con)
return(list(snp_table,gene_table,Recomb_rate,GWAS_cat))
} else {
query0 <- sprintf('select distinct snp,chr,position from Genome_SNP
where snp="%s";',variant)
res0<-dbSendQuery(con,query0)
snp_table <- dbFetch(res0)
if (length(snp_table)!=0) {
chromosome <- snp_table$chr
query1 <- sprintf('select distinct Gene.ENSG,Gene.symbol,ENST,ENSE,
Gene.start_at as G_start,Gene.end_at as G_end,Exon.start_at as E_start,
Exon.end_at as E_end,strand
from Exon join Gene using(ENSG)
where Gene.chromosome = (select distinct chr from Genome_SNP where snp="%s")
and Gene.end_at>(select distinct position-25000 from Genome_SNP where snp="%s")
and Gene.start_at<(select distinct position+25000 from Genome_SNP where snp="%s")
order by Gene.ENSG, Gene.start_at, Exon.start_at;',variant,variant,variant)
res1<-dbSendQuery(con,query1)
gene_table <- dbFetch(res1)
minp <- min(gene_table$G_start)
maxp <- max(gene_table$G_end)
query2 <- sprintf('select chr,pos,recomb_rate from Recomb_rate
where chr = "%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res2 <- dbSendQuery(con,query2)
Recomb_rate <- dbFetch(res2)
query3 = sprintf('select chr,pos,trait,snp from GWAS_catalog
where chr ="%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res3 <- dbSendQuery(con,query3)
GWAS_cat <- dbFetch(res3)
dbDisconnect(con)
return(list(snp_table,gene_table,Recomb_rate,GWAS_cat))
}
}
create_table <- function(variant) {
con<-dbConnect(SQLite(),"/restricted/projectnb/casa/_jychung/_gene2protein/db_g2p/gene2protein_v1.db")
query0 <- sprintf('select distinct snp,chr,position from Exon_SNP
where snp="%s";',variant)
res0<-dbSendQuery(con,query0)
snp_table <- dbFetch(res0)
if (length(snp_table)!=0) {
chromosome <- snp_table$chr
query1 <- sprintf('select distinct Gene.ENSG,Gene.symbol,ENST,ENSE,
Gene.start_at as G_start,Gene.end_at as G_end,Exon.start_at as E_start,
Exon.end_at as E_end,strand
from Exon join Gene using(ENSG)
where Gene.chromosome = (select distinct chr from Exon_SNP where snp="%s")
and Gene.end_at>(select distinct position-25000 from Exon_SNP where snp="%s")
and Gene.start_at<(select distinct position+25000 from Exon_SNP where snp="%s")
order by Gene.ENSG, Gene.start_at, Exon.start_at;',variant,variant,variant)
res1<-dbSendQuery(con,query1)
gene_table <- dbFetch(res1)
minp <- min(gene_table$G_start)
maxp <- max(gene_table$G_end)
query2 <- sprintf('select chr,pos,recomb_rate from Recomb_rate
where chr = "%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res2 <- dbSendQuery(con,query2)
Recomb_rate <- dbFetch(res2)
query3 = sprintf('select chr,pos,trait,snp from GWAS_catalog
where chr ="%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res3 <- dbSendQuery(con,query3)
GWAS_cat <- dbFetch(res3)
dbDisconnect(con)
return(list(snp_table,gene_table,Recomb_rate,GWAS_cat))
} else {
query0 <- sprintf('select distinct snp,chr,position from Genome_SNP
where snp="%s";',variant)
res0<-dbSendQuery(con,query0)
snp_table <- dbFetch(res0)
if (length(snp_table)!=0) {
chromosome <- snp_table$chr
query1 <- sprintf('select distinct Gene.ENSG,Gene.symbol,ENST,ENSE,
Gene.start_at as G_start,Gene.end_at as G_end,Exon.start_at as E_start,
Exon.end_at as E_end,strand
from Exon join Gene using(ENSG)
where Gene.chromosome = (select distinct chr from Genome_SNP where snp="%s")
and Gene.end_at>(select distinct position-25000 from Genome_SNP where snp="%s")
and Gene.start_at<(select distinct position+25000 from Genome_SNP where snp="%s")
order by Gene.ENSG, Gene.start_at, Exon.start_at;',variant,variant,variant)
res1<-dbSendQuery(con,query1)
gene_table <- dbFetch(res1)
minp <- min(gene_table$G_start)
maxp <- max(gene_table$G_end)
query2 <- sprintf('select chr,pos,recomb_rate from Recomb_rate
where chr = "%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res2 <- dbSendQuery(con,query2)
Recomb_rate <- dbFetch(res2)
query3 = sprintf('select chr,pos,trait,snp from GWAS_catalog
where chr ="%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res3 <- dbSendQuery(con,query3)
GWAS_cat <- dbFetch(res3)
dbDisconnect(con)
return(list(snp_table,gene_table,Recomb_rate,GWAS_cat))
}
}
}
snp <- "rs1641549"
create_table <- function(variant) {
con<-dbConnect(SQLite(),"/restricted/projectnb/casa/_jychung/_gene2protein/db_g2p/gene2protein_v1.db")
query0 <- sprintf('select distinct snp,chr,position from Exon_SNP
where snp="%s";',variant)
res0<-dbSendQuery(con,query0)
snp_table <- dbFetch(res0)
if (length(snp_table)!=0) {
chromosome <- snp_table$chr
query1 <- sprintf('select distinct Gene.ENSG,Gene.symbol,ENST,ENSE,
Gene.start_at as G_start,Gene.end_at as G_end,Exon.start_at as E_start,
Exon.end_at as E_end,strand
from Exon join Gene using(ENSG)
where Gene.chromosome = (select distinct chr from Exon_SNP where snp="%s")
and Gene.end_at>(select distinct position-25000 from Exon_SNP where snp="%s")
and Gene.start_at<(select distinct position+25000 from Exon_SNP where snp="%s")
order by Gene.ENSG, Gene.start_at, Exon.start_at;',variant,variant,variant)
res1<-dbSendQuery(con,query1)
gene_table <- dbFetch(res1)
minp <- min(gene_table$G_start)
maxp <- max(gene_table$G_end)
query2 <- sprintf('select chr,pos,recomb_rate from Recomb_rate
where chr = "%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res2 <- dbSendQuery(con,query2)
Recomb_rate <- dbFetch(res2)
query3 = sprintf('select chr,pos,trait,snp from GWAS_catalog
where chr ="%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res3 <- dbSendQuery(con,query3)
GWAS_cat <- dbFetch(res3)
dbDisconnect(con)
return(list(snp_table,gene_table,Recomb_rate,GWAS_cat))
} else {
query0 <- sprintf('select distinct snp,chr,position from Genome_SNP
where snp="%s";',variant)
res0<-dbSendQuery(con,query0)
snp_table <- dbFetch(res0)
if (length(snp_table)!=0) {
chromosome <- snp_table$chr
query1 <- sprintf('select distinct Gene.ENSG,Gene.symbol,ENST,ENSE,
Gene.start_at as G_start,Gene.end_at as G_end,Exon.start_at as E_start,
Exon.end_at as E_end,strand
from Exon join Gene using(ENSG)
where Gene.chromosome = (select distinct chr from Genome_SNP where snp="%s")
and Gene.end_at>(select distinct position-25000 from Genome_SNP where snp="%s")
and Gene.start_at<(select distinct position+25000 from Genome_SNP where snp="%s")
order by Gene.ENSG, Gene.start_at, Exon.start_at;',variant,variant,variant)
res1<-dbSendQuery(con,query1)
gene_table <- dbFetch(res1)
minp <- min(gene_table$G_start)
maxp <- max(gene_table$G_end)
query2 <- sprintf('select chr,pos,recomb_rate from Recomb_rate
where chr = "%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res2 <- dbSendQuery(con,query2)
Recomb_rate <- dbFetch(res2)
query3 = sprintf('select chr,pos,trait,snp from GWAS_catalog
where chr ="%s"
and pos>%d
and pos<%d
order by chr,pos;',chromosome,minp,maxp)
res3 <- dbSendQuery(con,query3)
GWAS_cat <- dbFetch(res3)
dbDisconnect(con)
return(list(snp_table,gene_table,Recomb_rate,GWAS_cat))
}
}
}
if(!is.null(snp)){
dtable <- create_table(snp)
snp_table <- dtable[[1]]
gene_table <- dtable[[2]]
Recomb_rate <- dtable[[3]]
GWAS_cat <- dtable[[4]]
}
library(ggplot2)
library(gggenes)
library(cowplot)
library(getopt)
library(RSQLite)
suppressMessages(library(cowplot))
if(!is.null(snp)){
dtable <- create_table(snp)
snp_table <- dtable[[1]]
gene_table <- dtable[[2]]
Recomb_rate <- dtable[[3]]
GWAS_cat <- dtable[[4]]
}
con<-dbConnect(SQLite(),"/restricted/projectnb/casa/_jychung/_gene2protein/db_g2p/gene2protein_v1.db")
query0 <- sprintf('select distinct snp,chr,position from Exon_SNP
where snp="%s";',variant)
variant <- "rs1641549"
query0 <- sprintf('select distinct snp,chr,position from Exon_SNP
where snp="%s";',variant)
res0<-dbSendQuery(con,query0)
snp_table <- dbFetch(res0)
length(snp_table)
nrow(snp_table)
